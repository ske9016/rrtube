<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>РРУТУБ — Смотреть онлайн</title>
    <style>
        body { background-color: #0b0b0b; color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        #nav { background: #1a1a1a; padding: 15px 40px; border-bottom: 3px solid #005bff; font-weight: bold; color: #005bff; font-size: 24px; }
        
        /* Основная страница */
        #video-page { display: block; }
        #player-wrapper { width: 90%; max-width: 1000px; margin: 30px auto; position: relative; aspect-ratio: 16/9; background: #000; border: 1px solid #333; }
        #rutube-container, #rick-layer { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        iframe, video { width: 100%; height: 100%; border: none; }

        /* Страница /stas */
        #stas-page { display: none; height: 100vh; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .counter { font-size: 100px; color: #005bff; font-weight: bold; text-shadow: 0 0 20px rgba(0,91,255,0.5); }

        /* Рекламный слой */
        #rick-layer { display: none; z-index: 500; background: #000; }
        #skip-btn { position: absolute; bottom: 40px; right: 40px; padding: 12px 25px; background: #fff; color: #000; border: none; font-weight: bold; cursor: pointer; z-index: 600; border-radius: 4px; }
        .ad-tag { position: absolute; top: 20px; left: 20px; background: #ed1c24; color: white; padding: 7px 15px; z-index: 600; font-size: 14px; font-weight: bold; }

        /* Кнопка первого клика */
        #start-screen { position: absolute; z-index: 1000; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .play-circle { background: #005bff; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; margin-bottom: 10px; transition: 0.2s; }
        #start-screen:hover .play-circle { transform: scale(1.1); background: #0046c7; }
    </style>
</head>
<body>

<div id="nav">РРУТУБ</div>

<div id="video-page">
    <div id="player-wrapper">
        <div id="start-screen" onclick="initVideo()">
            <div class="play-circle">▶</div>
            <p>Нажмите для воспроизведения</p>
        </div>
        <div id="rutube-container"></div>
        <div id="rick-layer">
            <div class="ad-tag" id="ad-info">РЕКЛАМА: 30 сек.</div>
            <button id="skip-btn">Пропустить</button>
            <video id="rick-video" playsinline>
                <source src="1.mp4" type="video/mp4">
                Ваш браузер не поддерживает видео.
            </video>
        </div>
    </div>
</div>

<div id="stas-page">
    <h1 style="color: #555;"></h1>
    <div class="counter" id="count-display">0</div>
    <p></p>
</div>

<script>
    const rickVideo = document.getElementById('rick-video');
    const rutubeBox = document.getElementById('rutube-container');
    const rickLayer = document.getElementById('rick-layer');
    const skipBtn = document.getElementById('skip-btn');

    // Проверка на /stas через URL
    if (window.location.search.includes('stas')) {
        document.getElementById('video-page').style.display = 'none';
        document.getElementById('stas-page').style.display = 'flex';
        document.getElementById('count-display').innerText = localStorage.getItem('rickCount') || 0;
    }

    let timer = 0;
    let isFinalTrap = false;
    let count = parseInt(localStorage.getItem('rickCount') || 0);

    function initVideo() {
        document.getElementById('start-screen').style.display = 'none';
        loadRutube();
        // Запуск таймера
        setInterval(() => {
            if (isFinalTrap) return;
            timer++;
            
            // Каждые 30 секунд включаем рикролл (до 100-й секунды)
            if (timer % 30 === 0 && timer < 100) {
                triggerRick(30);
            }
            
            // Финальный переход на 100-й секунде
            if (timer >= 100) {
                isFinalTrap = true;
                triggerRick(3600); // На 1 час
            }
        }, 1000);
    }

    function loadRutube() {
        // Перезагружаем Rutube (он начнет играть сначала или с паузы)
        rutubeBox.innerHTML = `<iframe src="https://rutube.ru/play/embed/c9bf171c445025e52d5245150bd9ead4/?autoplay=1" allow="autoplay"></iframe>`;
        rickLayer.style.display = 'none';
        rickVideo.pause();
    }

    function triggerRick(dur) {
        // Обновляем счетчик
        count++;
        localStorage.setItem('rickCount', count);
        
        // Выключаем Rutube
        rutubeBox.innerHTML = '';
        
        // Включаем 1.mp4
        rickLayer.style.display = 'block';
        rickVideo.currentTime = 0;
        rickVideo.play();
        rickVideo.volume = 1.0; // Максимальная громкость

        let left = dur;
        let cd = setInterval(() => {
            left--;
            document.getElementById('ad-info').innerText = `РЕКЛАМА: ${left} сек.`;
            if (left <= 0) {
                clearInterval(cd);
                if (!isFinalTrap) loadRutube();
            }
        }, 1000);
    }

    // Убегающая кнопка с издевкой
    const phrases = ["НЕА", "МИМО", "ХА-ХА", "КУДА?", "ПОЙМАЙ"];
    skipBtn.onmouseover = function() {
        skipBtn.style.left = Math.random() * 70 + 10 + '%';
        skipBtn.style.top = Math.random() * 70 + 10 + '%';
        skipBtn.innerText = phrases[Math.floor(Math.random() * phrases.length)];
        
        // Можно добавить короткий писк при "промахе"
        const beep = new AudioContext();
        const osc = beep.createOscillator();
        osc.connect(beep.destination);
        osc.start();
        osc.stop(beep.currentTime + 0.1);
    };
</script>
</body>
</html>
