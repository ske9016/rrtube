<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>РРУТУБ — Главное видео дня</title>
    <style>
        body { background-color: #0b0b0b; color: white; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; overflow: hidden; }
        
        /* Шапка */
        #nav { 
            background: #1a1a1a; padding: 12px 40px; 
            border-bottom: 3px solid #005bff; 
            display: flex; align-items: center; justify-content: space-between;
        }
        #logo { color: #005bff; font-weight: bold; font-size: 26px; text-decoration: none; letter-spacing: -1px; }

        /* Видео-зона */
        #video-page { display: block; }
        #player-wrapper { 
            width: 95%; max-width: 1100px; margin: 30px auto; 
            position: relative; aspect-ratio: 16/9; 
            background: #000; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.7);
        }
        #rutube-container, #rick-layer { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        iframe, video { width: 100%; height: 100%; border: none; }

        /* Рекламный оверлей */
        #rick-layer { display: none; z-index: 500; background: #000; }
        #skip-btn { 
            position: absolute; bottom: 40px; right: 40px; 
            padding: 12px 25px; background: #fff; color: #000; 
            border: none; font-weight: bold; cursor: pointer; 
            z-index: 600; border-radius: 4px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .ad-tag { 
            position: absolute; top: 20px; left: 20px; 
            background: #ed1c24; color: white; padding: 7px 15px; 
            z-index: 600; font-size: 14px; font-weight: bold; border-radius: 2px;
        }

        /* Кнопка старта */
        #start-screen { 
            position: absolute; z-index: 1000; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; cursor: pointer; 
        }
        .play-circle { 
            background: #005bff; width: 80px; height: 80px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 35px; margin-bottom: 15px; transition: 0.3s; 
        }
        #start-screen:hover .play-circle { transform: scale(1.1); background: #0046c7; }

        /* Страница статистики */
        #stas-page { 
            display: none; height: 100vh; flex-direction: column; 
            align-items: center; justify-content: center; text-align: center; 
        }
        .counter-val { font-size: 120px; color: #005bff; font-weight: bold; line-height: 1; }
        .counter-label { font-size: 20px; color: #777; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

<div id="nav">
    <a href="/" id="logo">РРУТУБ</a>
</div>

<div id="video-page">
    <div id="player-wrapper">
        <div id="start-screen" onclick="initVideo()">
            <div class="play-circle">▶</div>
            <p style="font-size: 18px;">Нажмите, чтобы начать просмотр</p>
        </div>
        
        <div id="rutube-container"></div>
        
        <div id="rick-layer">
            <div class="ad-tag" id="ad-info">РЕКЛАМА: 30 сек.</div>
            <button id="skip-btn">Пропустить</button>
            <video id="rick-video" playsinline>
                <source src="1.mp4" type="video/mp4">
            </video>
        </div>
    </div>
    <div style="width: 95%; max-width: 1100px; margin: 0 auto;">
        <h1 style="font-size: 22px;">ШОК! Как сделать бесконечный двигатель из картошки и магнита</h1>
        <p style="color: #aaa; font-size: 14px;">1 240 562 просмотра • 21 января 2026 г.</p>
    </div>
</div>

<div id="stas-page">
    <div class="counter-label">Всего зарекролено людей в мире:</div>
    <div class="counter-val" id="count-display">...</div>
    <div style="margin-top: 40px; color: #444;">Панель управления Стаса v1.0</div>
</div>

<script>
    const rickVideo = document.getElementById('rick-video');
    const rutubeBox = document.getElementById('rutube-container');
    const rickLayer = document.getElementById('rick-layer');
    const skipBtn = document.getElementById('skip-btn');
    const countDisplay = document.getElementById('count-display');

    // Настройки
    const API_KEY = "rrutube_prikol_unique_id_2026"; // Уникальный ключ для статистики
    const rutubeEmbed = "https://rutube.ru/play/embed/c9bf171c445025e52d5245150bd9ead4/?autoplay=1";

    // ПРОВЕРКА: Если в ссылке есть ?stas, показываем статистику
    if (window.location.search.includes('stas')) {
        document.getElementById('video-page').style.display = 'none';
        document.getElementById('stas-page').style.display = 'flex';
        
        // Запрос глобальной статистики
        fetch(`https://api.countapi.xyz/get/${API_KEY}/hits`)
            .then(res => res.json())
            .then(data => { countDisplay.innerText = data.value || 0; })
            .catch(() => { countDisplay.innerText = "ОШИБКА"; });
    }

    let timer = 0;
    let isFinalTrap = false;

    function initVideo() {
        document.getElementById('start-screen').style.display = 'none';
        loadRutube();
        
        setInterval(() => {
            if (isFinalTrap) return;
            timer++;
            
            // Каждые 30 секунд (до 100-й секунды)
            if (timer % 30 === 0 && timer < 100) {
                triggerRick(30);
            }
            
            // Финал на 100-й секунде
            if (timer >= 100) {
                isFinalTrap = true;
                triggerRick(3600); // 1 час
            }
        }, 1000);
    }

    function loadRutube() {
        rutubeBox.innerHTML = `<iframe src="${rutubeEmbed}" allow="autoplay"></iframe>`;
        rickLayer.style.display = 'none';
        rickVideo.pause();
    }

    function triggerRick(dur) {
        // Отправляем сигнал о рикролле в глобальную статистику
        fetch(`https://api.countapi.xyz/hit/${API_KEY}/hits`).catch(() => {});

        // Выключаем Rutube и включаем 1.mp4
        rutubeBox.innerHTML = '';
        rickLayer.style.display = 'block';
        rickVideo.currentTime = 0;
        rickVideo.play();
        rickVideo.volume = 1.0;

        let left = dur;
        let cd = setInterval(() => {
            left--;
            document.getElementById('ad-info').innerText = `РЕКЛАМА: ${left} сек.`;
            if (left <= 0) {
                clearInterval(cd);
                if (!isFinalTrap) loadRutube();
            }
        }, 1000);
    }

    // ЛОГИКА УБЕГАЮЩЕЙ КНОПКИ
    const phrases = ["НЕ ПОПАЛ!", "ХА-ХА!", "МИМО!", "КУДА?!", "НЕ-А!"];
    skipBtn.onmouseover = function() {
        const x = Math.random() * 75 + 10;
        const y = Math.random() * 75 + 10;
        skipBtn.style.left = x + '%';
        skipBtn.style.top = y + '%';
        skipBtn.innerText = phrases[Math.floor(Math.random() * phrases.length)];
        
        // Звук писка при промахе (через AudioContext, не нужны файлы)
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.frequency.value = 800;
        gain.gain.value = 0.1;
        osc.start();
        osc.stop(ctx.currentTime + 0.1);
    };
</script>

</body>
</html>
