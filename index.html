<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>РРУТУБ — Главное видео недели</title>
    <style>
        body { background-color: #0f0f0f; color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        #header { background: #1a1a1a; padding: 15px 50px; border-bottom: 2px solid #005bff; font-weight: bold; color: #005bff; font-size: 22px; }
        
        #main-container { width: 90%; max-width: 1000px; margin: 20px auto; position: relative; }
        .video-box { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; }
        
        iframe, video { width: 100%; height: 100%; border: none; position: absolute; }

        /* Начальная кнопка запуска */
        #start-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 500; display: flex;
            flex-direction: column; align-items: center; justify-content: center; cursor: pointer;
        }
        .play-btn { width: 80px; height: 80px; background: #005bff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; }

        /* Слой Рикролла */
        #rick-layer { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: black; display: none; z-index: 100; 
        }

        /* Убегающая кнопка */
        #skip-button {
            position: absolute; bottom: 50px; right: 50px;
            padding: 12px 24px; background: #fff; color: #000; 
            border: none; cursor: pointer; font-weight: bold;
            transition: all 0.1s ease; z-index: 101; border-radius: 2px;
        }

        .ad-label {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0,0,0,0.8); padding: 8px 15px;
            font-size: 14px; z-index: 101; border: 1px solid #444;
        }
    </style>
</head>
<body>

<div id="header">РРУТУБ</div>

<div id="main-container">
    <div class="video-box">
        <div id="start-overlay" onclick="startEverything()">
            <div class="play-btn">▶</div>
            <p>Нажмите, чтобы начать просмотр</p>
        </div>

        <iframe id="main-video" src="https://rutube.ru/play/embed/c9bf171c445025e52d5245150bd9ead4/?autoplay=0" allow="autoplay"></iframe>

        <div id="rick-layer">
            <div class="ad-label" id="ad-text">Реклама: 30 сек.</div>
            <button id="skip-button">Пропустить</button>
            <video id="rick-video" playsinline>
                <source src="https://www.w3schools.com/tags/movie.mp4"" type="video/mp4"> <source src="https://shlyapa.net/rick.mp4" type="video/mp4">
            </video>
        </div>
    </div>
    <h2>Разбор интересной задачки из аналитической геометрии</h2>
</div>

<script>
    const rickLayer = document.getElementById('rick-layer');
    const rickVideo = document.getElementById('rick-video');
    const skipBtn = document.getElementById('skip-button');
    const mainIframe = document.getElementById('main-video');
    const startOverlay = document.getElementById('start-overlay');
    
    let seconds = 0;
    let isTrapActive = false;
    let isFinalTrap = false;

    function startEverything() {
        startOverlay.style.display = 'none';
        // Перезагружаем айфрейм с автоплеем после клика
        mainIframe.src += "&autoplay=1";
        
        // Запускаем таймер
        setInterval(tick, 1000);
    }

    function tick() {
        if (isFinalTrap) return;
        seconds++;

        // Раз в 60 секунд включаем рикролл
        if (seconds % 30 === 0 && seconds < 300) {
            triggerRickroll(30);
        }

        // На 5-й минуте включаем бесконечный рикролл
        if (seconds >= 100 && !isFinalTrap) {
            isFinalTrap = true;
            triggerRickroll(3600);
        }
    }

    function triggerRickroll(duration) {
        isTrapActive = true;
        rickLayer.style.display = 'block';
        
        // Прямая ссылка на рикролл (MP4 без рекламы)
        rickVideo.src = "1.mp4"; 
        rickVideo.currentTime = 0;
        rickVideo.play();
        rickVideo.volume = 1.0; // Максимальный звук

        let timeLeft = duration;
        let countdown = setInterval(() => {
            timeLeft--;
            document.getElementById('ad-text').innerText = `Реклама закончится через: ${timeLeft} сек.`;
            if (timeLeft <= 0 || !isTrapActive) {
                clearInterval(countdown);
                if (!isFinalTrap) stopRickroll();
            }
        }, 1000);
    }

    function stopRickroll() {
        isTrapActive = false;
        rickLayer.style.display = 'none';
        rickVideo.pause();
    }

    // УБЕГАЮЩАЯ КНОПКА + ИЗДЕВАТЕЛЬСТВО
    const phrases = ["ХЕ-ХЕ", "НЕ ПОПАЛ", "МИМО", "НУ ЖМИ", "ПОЧТИ!", "УПС!"];
    skipBtn.onmouseover = function() {
        const x = Math.random() * (rickLayer.clientWidth - skipBtn.clientWidth);
        const y = Math.random() * (rickLayer.clientHeight - skipBtn.clientHeight);
        skipBtn.style.left = x + 'px';
        skipBtn.style.top = y + 'px';
        skipBtn.innerText = phrases[Math.floor(Math.random() * phrases.length)];
    };
</script>

</body>
</html>
